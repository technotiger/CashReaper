#!/bin/bash
LOGLOC=/var/log/picash/pawns
HOSTNAME=`hostname`
if [[ ! -z $STAGGER ]]
then
    sleep $[ ( $RANDOM % 30 )  + 1 ]s
fi

(
if [[ "$USE_PAWNSAPP" != "n" ]]
then
    echo Starting Pawnsapp Service
    if [[ `uname -m` != "aarch64" ]]
    then
        /usr/bin/qemu-arm /usr/bin/pawns-cli -email=${PA_EMAIL} -password=${PA_PASSWORD} -device-name=${HOSTNAME} -accept-tos 
    else
        /usr/bin/pawns-cli -email=${PA_EMAIL} -password=${PA_PASSWORD} -device-name=${HOSTNAME} -accept-tos 
    fi
    echo Pawnsapp service crashed, restarting
else
    echo Not running pawnsapp service, sleeping...
    sleep 360
fi
sleep 60
) | rotatelogs -fDen 5 $LOGLOC 100M
